<!DOCTYPE html>
<html style="overflow: hidden;">
<head>
    <meta lang="zh-cn">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="~/Content/css/framework-font.css" rel="stylesheet" />
    <link href="~/Content/css/framework-theme.css" rel="stylesheet" />
    <link href="~/Content/css/framework-ui.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-2.1.1.js"></script>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Content/js/dialog/dialog.js"></script>
    <link href="~/Content/js/dialog/dialog.css" rel="stylesheet" />
    <script src="~/Scripts/jquery.cookie-1.4.1.min.js"></script>
    <link href="~/Content/css/framework-theme.css" rel="stylesheet" />
    <script src="~/Content/js/framework-ui.js"></script>
    <link href="~/Content/css/select2.min.css" rel="stylesheet">
    <link href="~/Content/js/jqgrid/jqgrid.css" rel="stylesheet" />
    <script src="~/Scripts/select2.min.js"></script>
    <script src="~/Content/js/jqgrid/jqgrid.min.js"></script>
    <script src="~/Content/js/jqgrid/grid.locale-cn.js"></script>
    <script src="/Scripts/lodash.js"></script>
    <style>
        .select2-container {
            z-index: 99999;
        }
    </style>
</head>

<body style="overflow: hidden;">
    <div id="ajax-loader" style="cursor: progress; position: fixed; top: -50%; left: -50%; width: 200%; height: 200%; background: #fff; z-index: 10000; overflow: hidden;">
        <img src="~/Content/img/ajax-loader.gif" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; margin: auto;" />
    </div>
    <div id="theme-wrapper">
        <header class="navbar" id="header-navbar">
            <div class="container" style="padding-right: 0px;">
                <a href="#" id="logo" class="navbar-brand">智慧校园系统</a>
                <div class="clearfix">
                    <div class="nav-no-collapse navbar-left pull-left hidden-sm hidden-xs">
                        <ul class="nav navbar-nav pull-left"></ul>
                    </div>
                    <div class="nav-no-collapse pull-right" id="header-nav">
                        <ul class="nav navbar-nav pull-right">
                            <li class="dropdown profile-dropdown">
                                <a href="#" class="dropdown" data-toggle="dropdown">
                                    <img id="headIcon" alt="" />
                                    <span class="hidden-xs userInfo"></span>
                                </a>
                                <ul class="dropdown-menu pull-right">
                                    <li><a class="menuItem" data-id="userInfo" href="/SystemManage/User/Info"><i class="fa fa-user"></i>个人信息</a></li>
                                    <li><a data-id="new" href="/iPadFrame.html"><i class="fa fa-user"></i>现代风格</a></li>
                                    <li class="divider"></li>
                                    <li><a href="~/Login/OutLogin"><i class="ace-icon fa fa-power-off"></i>安全退出</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>
        <div id="page-wrapper" class="container">
            <div class="row">
                <div id="nav-col">
                    <section id="col-left" class="col-left-nano">
                        <div id="col-left-inner" class="col-left-nano-content">
                            <div id="make-small-nav" class="sidebar-fold">
                                <a>
                                    <i class="fa fa-bars"></i>
                                </a>
                            </div>
                            <div id="user-left-box" class="clearfix hidden-sm hidden-xs dropdown profile2-dropdown">
                                <div class="user-box">
                                    <span class="name userInfo"> </span>
                                    <span class="status">  <i class="fa fa-circle"></i>在线  </span>
                                </div>
                            </div>
                            <div class="collapse navbar-collapse navbar-ex1-collapse" id="sidebar-nav">
                                <ul class="nav nav-pills nav-stacked" id="nav_item"></ul>
                            </div>
                        </div>
                    </section>
                </div>
                <div id="content-wrapper">
                    <div class="content-tabs">
                        <button class="roll-nav roll-left tabLeft">
                            <i class="fa fa-backward"></i>
                        </button>
                        <nav class="page-tabs menuTabs">
                            <div class="page-tabs-content" style="margin-left: 0px;">
                                <a href="javascript:;" class="menuTab active" data-id="/Home/Default">欢迎首页</a>
                            </div>
                        </nav>
                        <button class="roll-nav roll-right tabRight">
                            <i class="fa fa-forward" style="margin-left: 3px;"></i>
                        </button>

                        <div class="btn-group roll-nav roll-right">
                            <button class="dropdown tabClose" data-toggle="dropdown">页签操作</button>
                            <ul class="dropdown-menu dropdown-menu-right">
                                <li style="text-align: center;cursor:pointer;"><span class="tabReload">刷新当前</span></li>
                                <li style="text-align: center;cursor:pointer;"><span class="tabCloseCurrent">关闭当前</span></li>
                                <li style="text-align: center;cursor:pointer;"><span class="tabCloseAll">全部关闭</span></li>
                                <li style="text-align: center;cursor:pointer;"><span class="tabCloseOther">只保留此项</span></li>
                            </ul>
                        </div>
                        <button class="roll-nav roll-right fullscreen"><i class="fa fa-arrows-alt"></i></button>
                    </div>
                    <div class="content-iframe" style="background-color: #f9f9f9; overflow: hidden;">
                        <div class="mainContent" id="content-main" style="margin: 10px; margin-bottom: 0px; padding: 0;">
                            <iframe class="NFine_iframe" src="/Home/Default" frameborder="0" data-id="/Home/Default"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="loadingPage" style="display: none;">
        <div class="loading-shade"></div>
        <div class="loading-content" onclick="$.loading(false)">数据加载中，请稍后…</div>
    </div>

    <script>

        var storage, fail, uid;
        try {
            uid = new Date;
            (storage = window.localStorage).setItem(uid, uid);
            fail = storage.getItem(uid) != uid;
            storage.removeItem(uid);
            fail && (storage = false);
        } catch (e) { }

        if (storage) {
            var usedSkin = localStorage.getItem('config-skin');
            if (usedSkin != '' && usedSkin != null) {
                document.body.className = usedSkin;
            }
            else {
                document.body.className = 'theme-blue-gradient';
                localStorage.setItem('config-skin', "theme-blue-gradient");
            }
        }
        else {
            document.body.className = 'theme-blue';
        }

        $.fn.removeClassPrefix = function (prefix) {
            this.each(function (i, el) {
                var classes = el.className.split(" ").filter(function (c) {
                    return c.lastIndexOf(prefix, 0) !== 0;
                });
                el.className = classes.join(" ");
            });
            return this;
        };

        function getUserData() {
            $.ajax({
                url: "/SystemManage/User/GetUserData",
                type: "get",
                dataType: "json",
                async: false,
                success: function (r) {
                    window.clients = r.data;
                    for (var k in r.data) {
                        if (typeof (r.data[k]) == 'string') {
                            localStorage.setItem(k, r.data[k]);
                        } else {
                            localStorage.setItem(k, JSON.stringify(r.data[k]));
                        }

                    }
                    $(".userInfo").html(localStorage.getItem("userName"));
                    $("#headIcon").attr("src", localStorage.getItem("headIcon"));
                }
            });
        }

        function getDicData() {
            $.ajax({
                url: "/SystemManage/Dic/GetData",
                type: "get",
                dataType: "json",
                async: false,
                success: function (data) {
                    for (var k in data) {
                        if (typeof (data[k]) == 'string') {
                            localStorage.setItem(k, data[k]);
                        } else {
                            localStorage.setItem(k, JSON.stringify(data[k]));
                        }
                    }
                }
            });
        }
        /**
         * 加载菜单
         * */
        function menuTree() {
            let data = JSON.parse(localStorage.getItem("menus"));
            console.log(data)
            data = _.filter(data, function (n) {
                return n.belongSys === '1'
            });
            let _menu = getTree(data);
            $("#sidebar-nav ul").prepend(_menu);

            function getTree(dt) {
                let menu = '';
                for (let i = 0, len = dt.length; i < len; i++) {
                    if (dt[i].parentId == "0") {
                        menu += '<li><a data-id="' + dt[i].id + '" href="#" class="dropdown-toggle"><i class="' + dt[i].icon + '"></i><span>' + dt[i].name + '</span><i class="fa fa-angle-right drop-icon"></i></a>'
                    } else {
                        menu += '<li><a href="' + (dt[i].url || '#') + '" class="' + (dt[i].childNodes.length > 0 ? 'dropdown-toggle' : 'menuItem') + '" data-index="' + dt[i].sortCode + '" data-id="' + dt[i].id + '">' + dt[i].name + '' + (dt[i].childNodes.length ? '<i class="fa fa-angle-right drop-icon"></i>' : '') + '</a>';
                    }
                    if (dt[i].childNodes) {
                        menu += '<ul class="submenu">';
                        menu += getTree(dt[i].childNodes);
                        menu += '</ul>';
                    }
                    menu += '</li>';
                }
                return menu
            }
        }

        /**
         * 初始化
         * */
        function init($) {
            if (storage) {
                try {
                    var usedSkin = localStorage.getItem('config-skin');
                    if (usedSkin != '') {
                        $('#skin-colors .skin-changer').removeClass('active');
                        $('#skin-colors .skin-changer[data-skin="' + usedSkin + '"]').addClass('active');
                    }
                }
                catch (e) { console.log(e); }
            }

            $('#config-tool-cog').on('click', function () { $('#config-tool').toggleClass('closed'); });
            $('#config-fixed-header').on('change', function () {
                var fixedHeader = '';
                if ($(this).is(':checked')) {
                    $('body').addClass('fixed-header');
                    fixedHeader = 'fixed-header';
                }
                else {
                    $('body').removeClass('fixed-header');
                    if ($('#config-fixed-sidebar').is(':checked')) {
                        $('#config-fixed-sidebar').prop('checked', false);
                        $('#config-fixed-sidebar').trigger('change'); location.reload();
                    }
                }
            });
            $('#skin-colors .skin-changer').on('click', function () {
                $('body').removeClassPrefix('theme-');
                $('body').addClass($(this).data('skin'));
                $('#skin-colors .skin-changer').removeClass('active');
                $(this).addClass('active');
                writeStorage(storage, 'config-skin', $(this).data('skin'));
            });
            function writeStorage(storage, key, value) {
                if (storage) {
                    try {
                        localStorage.setItem(key, value);
                    }
                    catch (e) { console.log(e); }
                }
            }

            $("#content-wrapper").find('.mainContent').height($(window).height() - 100);

            $(window).resize(function (e) {
                $("#content-wrapper").find('.mainContent').height($(window).height() - 100);
            });

            $('#sidebar-nav,#nav-col-submenu').on('click', '.dropdown-toggle', function (e) {
                e.preventDefault();
                var $item = $(this).parent();
                if (!$item.hasClass('open')) {
                    $item.parent().find('.open .submenu').slideUp('fast');
                    $item.parent().find('.open').toggleClass('open');
                }
                $item.toggleClass('open');
                if ($item.hasClass('open')) {
                    $item.children('.submenu').slideDown('fast', function () {
                        var _height1 = $(window).height() - 92 - $item.position().top;
                        var _height2 = $item.find('ul.submenu').height() + 10;
                        var _height3 = _height2 > _height1 ? _height1 : _height2;
                        $item.find('ul.submenu').css({
                            overflow: "auto"
                        })
                    });
                }
                else {
                    $item.children('.submenu').slideUp('fast');
                }
            });

            menuTree();

            $('body').on('mouseenter', '#page-wrapper.nav-small #sidebar-nav .dropdown-toggle', function (e) {
                if ($(document).width() >= 992) {
                    var $item = $(this).parent();
                    if ($('body').hasClass('fixed-leftmenu')) {
                        var topPosition = $item.position().top;

                        if ((topPosition + 4 * $(this).outerHeight()) >= $(window).height()) {
                            topPosition -= 6 * $(this).outerHeight();
                        }
                        $('#nav-col-submenu').html($item.children('.submenu').clone());
                        $('#nav-col-submenu > .submenu').css({ 'top': topPosition });
                    }

                    $item.addClass('open');
                    $item.children('.submenu').slideDown('fast');
                }
            });

            $('body').on('mouseleave', '#page-wrapper.nav-small #sidebar-nav > .nav-pills > li', function (e) {
                if ($(document).width() >= 992) {
                    var $item = $(this);
                    if ($item.hasClass('open')) {
                        $item.find('.open .submenu').slideUp('fast');
                        $item.find('.open').removeClass('open');
                        $item.children('.submenu').slideUp('fast');
                    }
                    $item.removeClass('open');
                }
            });

            $('body').on('mouseenter', '#page-wrapper.nav-small #sidebar-nav a:not(.dropdown-toggle)', function (e) {
                if ($('body').hasClass('fixed-leftmenu')) {
                    $('#nav-col-submenu').html('');
                }
            });

            $('body').on('mouseleave', '#page-wrapper.nav-small #nav-col', function (e) {
                if ($('body').hasClass('fixed-leftmenu')) {
                    $('#nav-col-submenu').html('');
                }
            });

            $('body').find('#make-small-nav').click(function (e) {
                $('#page-wrapper').toggleClass('nav-small');
            });

            $('body').find('.mobile-search').click(function (e) {
                e.preventDefault();
                $('.mobile-search').addClass('active');
                $('.mobile-search form input.form-control').focus();
            });

            $(document).mouseup(function (e) {
                var container = $('.mobile-search');
                if (!container.is(e.target) && container.has(e.target).length === 0) // ... nor a descendant of the container
                {
                    container.removeClass('active');
                }
            });

            $(window).load(function () {
                window.setTimeout(function () {
                    $('#ajax-loader').fadeOut();
                }, 300);
            });
        }

        $(function () {
            getUserData();
            init($);
            getDicData();
        });
    </script>
    <script src="~/Content/js/indextab.js"></script>
    <script src="~/Scripts/pace.min.js"></script>
</body>
</html>