@{
    ViewBag.Title = "Form";
    Layout = "~/Views/Shared/_Form.cshtml";
}
<script>
    var keyValue = $.request("keyValue");
    var F_GroupName = $.request("F_GroupName");
    $(function () {
        $("#F_TaskName").val(F_GroupName);
        initControl();
        //if (!!keyValue) {
        //    $.ajax({
        //        url: "/ScheduleManage/Schedule_WishCourseTask/GetWishCourseGroupFormJson",
        //        data: { keyValue: keyValue },
        //        dataType: "json",
        //        async: false,
        //        success: function (data) {
        //            $.each(data, function (i, item) {
        //                $('#' + item.F_CourseGroupId).prop('checked', true)
        //            })
        //        }
        //    });
        //}

    });

    function initControl() {
        $.ajax({
            url: "/ScheduleManage/Schedule_WishCourseTask/GetWishCourseGroupFormJson",
            data: { keyValue: keyValue },
            dataType: "json",
            async: false,
            success: function (data) {
                $.each(data, function (i) {
                    var $checkbox = $("<div class='ckbox'><input multiselect='true' type='checkbox' value='" + data[i]["F_CourseGroupId"] + "' name='F_CourseGroups' id='" + data[i]["F_CourseGroupId"] + "' /><label for='" + data[i]["F_CourseGroupId"] + "'>" + data[i]["Schedule_CourseGroup_Entity"].F_GroupName + "</label></div>")
                    if (data[i]['ifChecked']) {
                        $checkbox.find('input').attr('checked', 'checked')
                    }
                    $('#F_CourseGroups').append($checkbox)
                });
            }
        });
        //$('#F_CourseGroups').bindCheckBox({
        //    url: "/ScheduleManage/Schedule_WishCourseTask/GetWishCourseGroupFormJson?keyValue=" + keyValue,
        //    id: "F_Id",
        //    text: "Schedule_CourseGroup_Entity.F_GroupName",
        //    name: "F_CourseGroups"
        //})
    }

    function submitForm() {
        if (!$('#form1').formValid()) {
            return false;
        }
        if (keyValue == "")
        {
            $.modalAlert("请选择班级！", "warning");
            return;
        }
        var vals = "";
        $('input:checkbox:checked').each(function (index, item) {
            vals += $(this).val() + ",";
        });

        var postData = {
            F_TaskId: keyValue, F_TaskName: $("#F_TaskName").val(),
            F_StartTime: $("#F_StartTime").val(),
            F_EndTime: $("#F_EndTime").val(),
            F_CourseGroupIds: vals
        };
        $.loading(true, "正在处理...");
        $.submitForm({
            url: "/ScheduleManage/Schedule_WishCourseTask/ToTaskSubmit",
            param: postData,
            success: function () {
                $.loading(false)
            }
        })
    }
</script>
<form id="form1">
    <div style="padding-top: 30px; margin-right: 40px;">
        <table class="form">
            <tr>
                <th class="formTitle">正式任务名称</th>
                <td class="formValue">
                    <input id="F_TaskName" name="F_TaskName" type="text" class="form-control required" />
                </td>
            </tr>
            <tr>
                <th class="formTitle">预选科目</th>
                <td  class="formValue" id="F_CourseGroups"></td>
            </tr>
            <tr>
                <th class="formTitle">开始时间</th>
                <td class="formValue">
                    <input id="F_StartTime" name="F_StartTime" type="text" class="form-control input-wdatepicker required" onfocus="WdatePicker()" />
                </td>
            </tr>
            <tr>
                <th class="formTitle">结束时间</th>
                <td class="formValue">
                    <input id="F_EndTime" name="F_EndTime" type="text" class="form-control input-wdatepicker required" onfocus="WdatePicker()" />
                </td>
            </tr>
        </table>
    </div>
</form>