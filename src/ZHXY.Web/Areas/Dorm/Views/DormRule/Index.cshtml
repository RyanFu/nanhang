@{Layout = "~/Views/Shared/_Layout.cshtml"; }

<script>
    const UPDATE_URL = `/Dorm/DormRule/Update`;
    const GRID_URL = `/Dorm/DormRule/Load`;
    const GET_URL = `/Dorm/DormRule/Get`;
    let lastsel;

    $(function () {
        gridList();
    })

    function gridList() {
        $("#gridList").jqGrid({
            url: GRID_URL,
            styleUI: 'Bootstrap',
            datatype: 'json',
            sortname: 'id',
            sortorder: "desc",
            rownumbers: true,
            gridview: true,
            altRows: true,
            viewrecords: true,
            multiselect: false,
            //开启多选,
            rowNum: 15,
            autoGridWidthFix: 0,
            autoGridHeightFix: 0,
            shrinkToFit: true,
            loadonce: false,
            width: window.innerWidth,
            height: window.innerHeight * 0.9,
            jsonReader: {
                root: function (r) {
                    return r.data;
                }
            },
            colModel: [
                { label: 'ID', name: 'dayOfWeek', key: true },
                { label: '晚归时间', name: 'closedTime', editable: true, edittype: 'text' },
                { label: '未归时间', name: 'notReturnLimitTime', editable: true, edittype: 'text' },
                { label: '未出限制(h)', name: 'notOutLimit', editable: true, edittype: 'text' },
            ],
            editurl: UPDATE_URL,
            onSelectRow: function (id) {
                if (id && id !== lastsel) {
                    $("#save").removeClass("disabled");
                    jQuery('#gridList').jqGrid('restoreRow', lastsel);
                    jQuery('#gridList').jqGrid('editRow', id, true);
                    lastsel = id;
                } else {
                    $("#save").addClass("disabled");
                }
            },

        });

        $("#save").click(function () {
            $("#gridList").jqGrid("saveRow", lastsel, function (result) {
                if (result.responseJSON.state === 'success') {
                    $("#gridList").trigger("reloadGrid");
                } else {
                    $.modalMsg(result.responseJSON.message, "error");
                }
            });
        })
    }

</script>

<div class="topPanel">
    <div class="search">
        <table>
            <tr>
                <td>
                    <div class="input-group">
                        <input id="txt_keyword" type="text" class="form-control" placeholder="名称/编号" style="width: 200px;">
                        <span class="input-group-btn">
                            <button id="btn_search" type="button" class="btn  btn-primary"><i class="fa fa-search"></i></button>
                        </span>
                    </div>
                </td>
                <td>
                    <div class="toolbar">
                        <div class="btn-group">
                            <a class="btn btn-primary" onclick="$.reload()"><span class="glyphicon glyphicon-refresh"></span></a>
                        </div>
                        <div class="btn-group"> <a id="save" authorize="yes" class="btn btn-primary dropdown-text disabled">保存</a> </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="gridPanel">
    <table id="gridList"></table>
</div>